# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

# Архитектура приложения

В приложении используется архитектурный паттерн **Model-View-Presenter (MVP)**

- **Model (Модель)** - отвечает за хранение и обработку данных, а также за бизнес-логику
- **View (Вид или представление)** - отвечает за отображение данных и взаимодействие с пользователем
- **Presenter (Презентер или Представитель)** - служит посредником между моделью и видом. Регистрирует действия пользователя инициированные в представлении, и взаимодействует с моделью для обновления данных. Затем получает обновленные данные из модели, обрабатывает их и передает в представление для отображения

## Данные и типы данных, используемые в приложении

Продукт

```
interface IProduct {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number | null;
}
```

Данные списка продуктов возвращаемые сервером

```
interface IProductListResult {
  total: number;
  items: IProduct[];
}
```

Данные полей формы

```
interface IOrderForm {
  payment: PaymentMethod;
  address: string;
  email: string;
  phone: string;
}
```

Данные заказа для отправки на сервер

```
interface IOrder extends IOrderForm {
  items: string[];
  total: number;
}
```

Данные возвращаемые сервером при успешном оформлении заказа

```
interface IOrderResult {
  id: string;
  total: number;
}
```

Товар в корзине

```
type BasketItem = Pick<IProduct, 'id' | 'title' | 'price'>
```

Товар в каталоге

```
type CatalogItem = Omit<IProduct, 'description'>
```

Способы оплаты

```
type PaymentMethod = 'online' | 'cash'
```

Ошибки полей формы

```
type FormErrors = Partial<Record<keyof IOrder, string>>
```

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

#### Класс Component

Абстрактный класс является родителем для всех компонентов представления. Включает в себя набор инструментов для роботы с DOM в дочерних компонентах\
Поля:

- container: HTMLElement - корневой DOM-элемент компонента

Методы:

- render(data?: Partial<T>): HTMLElement - метод отрисовки представления
- setText(element: HTMLElement, value: string | number): void - установить текстовое содержимое
- toggleClass(element: HTMLElement, className: string, force?: boolean): void - переключить класс элемента
- setDisabled(element: HTMLElement, state: boolean): void - сменить статус блокировки

### Классы данных (Model)

#### Класс ProductData

Класс отвечает за хранение и логику работы с данными товаров.
Конструктор класса принимает инстант брокера событий\
Поля:

- products: IProduct[] - коллекция доступных товаров
- basket: BasketItem[] - коллекция товаров в корзине
- preview: string | null - id карточки, выбранной для просмотра в модальной окне
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных

Методы:

- getProducts(): IProduct[] - возвращает коллекцию доступных товаров
- getProduct(id: string): IProduct - возвращает товар по id
- addProduct(item: IProduct): void - добавляет товар в корзину
- removeProduct(id: string): void - удаляет товар из корзины
- clear(): void - чистить корзину после успешного оформления заказа
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс OrderData

Класс отвечает за хранение и логику работы с данными пользователя.
Конструктор класса принимает инстант брокера событий\
Поля:

- order: IOrderForm - данные введенные пользователем
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных

Методы:

- setPayment(PaymentMethod): void - устанавливает способ оплаты
- setAddress(id: string): void - устанавливает адрес
- setEmail(id: string): void - устанавливает email
- setPhone(id: string): void - устанавливает телефон
- setOrderField(field: keyof IOrderForm, value: string) - обновляет поле формы
- validateOrder(): boolean - валидация формы
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

### Классы представления (View)

Классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Page

Наследуется от класса Component и отвечает за отображение главной страницы, каталога товара, счетчика корзины и кнопки открытия корзины. Конструктор принимает два параметра, container в котором будет размещены элементы страницы, и экземпляр класса `EventEmitter` для инициации событий\
Поля:

- catalog: HTMLElement - контейнер разметки для отрисовки карточек
- basket: HTMLButtonElement - элемент корзины (кнопка)
- counter: HTMLElement - счетчик корзины

Сеттеры задают значения полям класса

#### Класс Product

Наследуется от класса Component и отвечающий за хранение и отображения товара в разных частях приложения. Класс является родительским для классов представления ProductBasket, ProductPreview, ProductCatalog. Конструктор принимает два параметра, container в котором будет размещены элементы товара, и экземпляр класса `EventEmitter` для инициации событий\
Поля:

- title: HTMLElement;
- image?: HTMLImageElement;
- category?: HTMLElement;
- description?: HTMLElement;
- price: HTMLSpanElement;
- id: string;

Сеттеры задают значения полям класса

#### Класс Basket

Наследуется от класса Component и отвечает за отображение списка товаров добавленных в корзину, итоговой суммы выбранных товаров. Конструктор принимает два параметра, container в котором будет размещены элементы корзины, и экземпляр класса `EventEmitter` для инициации событий\
Поля:

- productList: HTMLElement — контейнер списка товаров
- totalPrice: HTMLElement — сумма всех товаров
- button: HTMLButtonElement — кнопка оформления заказа

а также устанавливает слушатель на кнопку оформления заказа
Сеттеры задают значения полям класса

#### Класс Modal

Универсальный класс отвечающий за отображение модального окна наследуется от класса Component. Содержит методы open, close, render для управления отображением модального окна. Конструктор принимает container - корневой элемент модального окна, и экземпляр класса `EventEmitter` для инициации событий\
Поля:

- content: HTMLElement - содержимое модального окна
- closeButton: HTMLButtonElement - кнопка закрытия модального окна

#### Класс Form

Универсальный класс формы наследуется от класса Component. Предназначен для управления состоянием формы. Предназначен для управления состоянием формы, обработкой вводимых значений, валидацией и отправкой данных на сервер. Конструктор принимает container - корневой элемент формы, и экземпляр класса `EventEmitter` для инициации событий\
Поля:

- submitButton: HTMLButtonElement — кнопка оформления заказа
- error: HTMLElement — элемент отображения ошибок

#### Класс Success

Отвечает за отображение уведомления об успешном оформлении заказа\
Поля:

- container: HTMLElement — контейнер с сообщением
- totalPrice: HTMLElement — сумма заказа
- button: HTMLButtonElement — кнопка закрытия модального окна

### Слой коммуникации

#### Класс AppApi

Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

_Список событий, которые могут генерироваться в системе:_

- `catalog:change` - рендер товаров на странице
- `product:open` - preview товара в модальном окне
- `modal:open` - открыть модальное окно
- `modal:close` - закрыть модальное окно
- `basket:add` - добавить товар в корзину
- `basket:remove` - удалить товар из корзины
- `basket:changed` - рендер товаров в корзине
- `order:change` - изменить поля ввода формы
- `order:submit` - отправить заказ
- `order:error` - ошибка при отправки заказа
- `success:close` - закрыть окно уведомления
